<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width,minimum-scale=1.0" />
        <title>212æ—¥å¸¸ç•™å½±</title>


        <style>
            * {
                padding: 0;
                margin: 0;
                border: none;
            }
            body {
                visibility: hidden;
            }
            h1 {
                text-align: center;
                margin: 20px 0;
            }
            #photo_container {
                width: 100%;
            }
            img {
                width: 100%;
            }
            .item {
                /* è¿™ä¸ªå¾ˆé‡è¦ */
                box-sizing: border-box;
                margin: 0;
                padding: 10px;
                position: absolute;
            }
            .item img:hover {
                opacity: 0.5;
            }
            #tip {
                font-size: 13px;
                text-align: center;
                color: grey;
                margin: 30px 0;
            }
        </style>
    </head>
    <body id="body">
        <h1>æ¯ç‡¥æ— å‘³çš„ç”Ÿæ´»</h1>
        <div id="photo_container">
            <div class="item"> <img src="images/1.jpg" alt=""> </div>
            <div class="item"> <img src="images/2.jpg" alt=""> </div>
            <div class="item"> <img src="images/3.jpg" alt=""> </div>
            <div class="item"> <img src="images/4.jpg" alt=""> </div>
            <div class="item"> <img src="images/5.jpg" alt=""> </div>
            <div class="item"> <img src="images/6.jpg" alt=""> </div>
            <div class="item"> <img src="images/7.jpg" alt=""> </div>
            <div class="item"> <img src="images/1.jpg" alt=""> </div>
            <div class="item"> <img src="images/2.jpg" alt=""> </div>
            <div class="item"> <img src="images/3.jpg" alt=""> </div>
            <div class="item"> <img src="images/4.jpg" alt=""> </div>
            <div class="item"> <img src="images/5.jpg" alt=""> </div>
            <div class="item"> <img src="images/6.jpg" alt=""> </div>
            <div class="item"> <img src="images/7.jpg" alt=""> </div>
        </div>
        <p id="tip">åŠªåŠ›åŠ è½½ä¸­...</p>



        <script>
            
            var data = [
                {src:"1.jpg"},
                {src:"2.jpg"},
                {src:"3.jpg"},
                {src:"4.jpg"},
                {src:"5.jpg"},
                {src:"6.jpg"},
                {src:"7.jpg"},
                {src:"6.jpg"},
                {src:"6.jpg"},
                {src:"6.jpg"},
            ]
            var data_haveLoaded = -1;
            var maxWidth = window.screen.width - getScrollWidth();
            var contentWidth = 0.618*maxWidth;
            //å…ˆç¡®å®šå‘ˆç°åŒºåŸŸå®½åº¦ğŸ‘‡
            // document.getElementById("body").style.width = contentWidth + "px";
            // console.log(maxWidth);
            // console.log(document.getElementById("body").style.width);

            //ç€‘å¸ƒæµğŸ‘‡
            var photo_container  = document.getElementById("photo_container");
            var boxes = photo_container.getElementsByClassName("item");
            var itemWidth = contentWidth/3;//è®¾ç½®æ¯è¡Œå›¾ç‰‡æ•°ä¸º3
            var items = document.getElementsByClassName("item");
            var ori_itemsLenth = items.length;
            for(let i=0; i<items.length; i++){items[i].style.width = itemWidth + "px";} 
            var hArray = new Array;//å­˜å‚¨æ¯åˆ—å›¾ç‰‡è·ç¦»é¡¶ç«¯çš„ç»å¯¹é«˜åº¦

            function waterfall(photo_container,boxes,data_haveLoaded) {
                var i = 0;
                if(data_haveLoaded>-1){
                    // console.log("è¿™æ²¡é—®é¢˜");
                    i = data_haveLoaded + ori_itemsLenth;
                    
                    // console.log(data_haveLoaded +"  "+ i);
                } 
                for(; i<items.length; i++){
                    if(i<3){
                        hArray[i] = document.getElementById("photo_container").offsetTop;//ç»å¯¹å®šä½åŸºäºé¡µé¢æœ€é¡¶éƒ¨
                        items[i].style.top = hArray[i] + "px";
                        // hArray[i] += items[i].style.height; //æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºcssä¸­å¹¶æœªæ˜ç¡®å®šä¹‰heightçš„å€¼ï¼
                        hArray[i] += items[i].clientHeight;//ï¼Ÿï¼Ÿè¿˜æœ‰å¾…éªŒè¯ç²¾ç¡®åº¦
                        // console.log("%f",items[i].clientHeight);
                        items[i].style.left = 0.5*(1-0.618)*maxWidth + itemWidth*i + "px";
                    }else{
                        var minHeight = Math.min(hArray[0],Math.min(hArray[1],hArray[2]));
                        // var minIndex = function(){
                        //     if(minHeight == hArray[0]) return 0;
                        //     else if(minHeight == hArray[1]) return 1;
                        //     else return 2;
                        // }//é”™è¯¯ï¼ŒåŸå› ï¼Ÿï¼Ÿï¼Ÿ
                        var minIndex = -1;
                        if(minHeight == hArray[0]) minIndex = 0;
                        else if(minHeight == hArray[1]) minIndex = 1;
                        else minIndex = 2;
                        //è·å–æœ€å°é«˜åº¦åŠå…¶åºåˆ—ï¼ˆå¯ç»§ç»­ä¼˜åŒ–ï¼‰
                        // console.log(minIndex);
                        items[i].style.top = hArray[minIndex] + "px";//ccccæˆ‘tmæ˜¯ç…ç¬”å—ï¼Œä¸ºå•¥è¦å†™i%3å•Šå•Šå•Šå•Š
                        hArray[minIndex] += items[i].clientHeight;
                        items[i].style.left = 0.5*(1-0.618)*maxWidth + itemWidth*minIndex + "px";
                    }
                    // console.log(hArray[0]+" "+hArray[1]+" "+hArray[2]);
                    // console.log(items[i].clientHeight);
                    // console.log(items[i].offsetTop+"  "+items[i].style.top);
                    photo_container.style.height = Math.max(hArray[0],Math.max(hArray[1],hArray[2])) + "px";
                }
                // console.log(hArray);
            }
            function getScrollWidth() {
                var noScroll, scroll, oDiv = document.createElement("div");
                oDiv.style.cssText = "position:absolute; top:-1000px; width:100px; height:100px; overflowY:hidden;";
                noScroll = document.body.appendChild(oDiv).clientWidth;
                oDiv.style.overflowY = "scroll";
                scroll = oDiv.clientWidth;
                document.body.removeChild(oDiv);
                return noScroll-scroll;
            }
            function lazyLoad(photo_container,boxes) {
                if(data_haveLoaded == -1)data_haveLoaded++;//ä½¿ç”±-1å˜æˆ0ï¼Œè¡¨ç¤ºæ‡’åŠ è½½å¯åŠ¨
                // console.log(data_haveLoaded);
                for(let i=data_haveLoaded;(i<data_haveLoaded+3)&&(i<data.length);i++){
                    var newDiv = document.createElement('div');
                    var newImg = document.createElement('img');
                    newDiv.className = "item";
                    newImg.src = "images/" + data[i].src;
                    newDiv.style.width = itemWidth + "px";
                    newDiv.appendChild(newImg);
                    photo_container.appendChild(newDiv);
                }
                waterfall(photo_container,boxes,data_haveLoaded);
                //æ¯æ¬¡åªåŠ è½½3å¼ 
                if(data_haveLoaded+3>data.length) data_haveLoaded = data.length;
                else data_haveLoaded += 3
            }
            


            window.onload = function() {
                if(window.screen.width < 720) {
                   alert("è¯·æ¨ªå±åé£Ÿç”¨ (Â°ãƒ¼Â°ã€ƒ)"); 
                   return false;
                } 
                setTimeout(function(){
                    document.getElementById("body").style.visibility = "visible";
                }, 100);
                waterfall(photo_container,boxes,data_haveLoaded);
            }
            
            window.onscroll =function(){//æ‡’åŠ è½½ğŸ‘‡
                //ğŸ‘‡è¶…çº§å…³é”®çš„åˆ¤æ–­æ¡ä»¶
                console.log(document.body.scrollHeight+"  "+document.body.scrollTop+"  "+window.innerHeight)
                if(document.documentElement.scrollHeight ||document.body.scrollHeight < document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset + window.innerHeight){
                    if(data_haveLoaded < data.length){
                        setTimeout(function(){
                            lazyLoad(photo_container,boxes)
                        }, 600);
                        //æ³¨æ„ï¼æ²¡æœ‰function(){}åŒ…å«æ— æ³•æˆåŠŸå»¶æ—¶ï¼ï¼ï¼  
                    }  
                    else if(data_haveLoaded == data.length){
                        let Para = document.getElementById('tip');
                        Para.innerHTML = "ä»€ä¹ˆï¼Ÿä½ è¿˜è¦ï¼Ÿï¼";
                        setTimeout(function(){
                            Para.innerHTML = "çœŸçš„æ²¡å•¦ï¼";
                        },500)
                    }
                }
            }
            // window.Î¿nresize=function(){
            //     alert("aaa")
            //     location.reload();
            // }

        </script>
    </body>


</html>